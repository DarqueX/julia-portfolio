
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Админка — Юлия Василевская</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet"/>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      padding: 2rem;
      background: #f5f5f5;
    }
    #loginForm, #adminPanel {
      max-width: 500px;
      margin: auto;
      background: white;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    input, textarea, button {
      display: block;
      width: 100%;
      margin-bottom: 1rem;
      padding: 0.75rem;
      font-size: 1rem;
    }
    button {
      cursor: pointer;
      background: #333;
      color: white;
      border: none;
      transition: background 0.3s ease;
    }
    button:hover {
      background: #000;
    }
  </style>

  

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-storage-compat.js"></script>


</head>
<body>

  <div id="loginForm">
    <h2>Вход в админку</h2>
    <input id="loginEmail" type="email" placeholder="Email" required>
    <input id="loginPassword" type="password" placeholder="Пароль" required>
    <button onclick="login()">Войти</button>
  </div>

  <div id="adminPanel" style="display:none">
    <h2>Добавить публикацию</h2>
    <input id="postTitle" type="text" placeholder="Заголовок">
    <textarea id="postText" placeholder="Текст публикации"></textarea>
    <button onclick="addPost()">Опубликовать</button>
 

<br></br>
 <br></br>

    <!-- Редактирование Портфолио -->
    <hr>
<h2>Добавить карточку в портфолио</h2>

<label for="category">Категория:</label>
    <br></br>
<select id="portfolioCategory">
  <option value="колонка">Журналистика</option>
  <option value="посты-для-соцсетей">Социальные сети</option>
  <option value="seo-статьи">Копирайтинг и Брендинг</option>
</select>

<input id="portfolioTitle" type="text" placeholder="Название работы">
<input id="portfolioDescription" type="text" placeholder="Описание или тип текста">
<input id="portfolioFile" type="file" accept="application/pdf">
<button onclick="addPortfolioCard()">Добавить карточку</button>

    <br></br>
    <br></br>

    <!-- Переключение стиля заголовков -->
<label for="heading-style">Стиль заголовков:</label>
<select id="heading-style">
  <option value="default">С левой цветной полосой (по умолчанию)</option>
  <option value="gradient">Градиент</option>
  <option value="glow">Светящийся</option>
  <option value="animated">Анимация</option>
  <option value="glass">Полупрозрачный / blur</option>
  <option value="bordered">Чёрный фон</option>
  <option value="glass-blur">Стеклянный с дымкой</option>
  <option value="outlinefix">Границы</option>
</select>

 <br></br>
  <br></br>
    

 <!-- Кнопка выхода -->
  <button onclick="logout()">Выйти</button>
  </div>

   <!-- Ссылка на главную страницу -->
  <a href="index.html" style="display:block; margin-top: 1rem; text-align:center;">← На главную</a>
  
<!--Подключение env.js-->
  <script src=".env.js"></script>
<script src="admin.js"></script> <!-- или просто <script>...</script> если код в HTML -->


  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBph0OE68RE_vo0XOjCaPweyqQNR-rJVkI",
      authDomain: "julia-profile-site.firebaseapp.com",
      projectId: "julia-profile-site",
      storageBucket: "julia-profile-site.appspot.com",
      messagingSenderId: "539619849387",
      appId: "1:539619849387:web:4af99cad0ff10b0ba233ee"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const loginForm = document.getElementById('loginForm');
    const adminPanel = document.getElementById('adminPanel');

    function login() {
      const email = document.getElementById("loginEmail").value;
      const password = document.getElementById("loginPassword").value;
      auth.signInWithEmailAndPassword(email, password)
        .then(() => {
          loginForm.style.display = "none";
          adminPanel.style.display = "block";
        })
        .catch((error) => alert("Ошибка входа: " + error.message));
    }

   async function addPost() {
  const title = document.getElementById("postTitle").value.trim();
  const text = document.getElementById("postText").value.trim();

     // Временный лог
     console.log("Заголовок:", title);
    console.log("Текст:", text);

  if (title && text) {
    await db.collection("posts").add({
      title: title,
      text: text,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    }).then(() => {
      document.getElementById("postTitle").value = "";
      document.getElementById("postText").value = "";
      alert("Пост опубликован!");
    }).catch(err => alert("Ошибка: " + err.message));
  } else {
    alert("Пожалуйста, заполните заголовок и текст.");
  }
}


    auth.onAuthStateChanged((user) => {
      if (user) {
        loginForm.style.display = "none";
        adminPanel.style.display = "block";
      }
    });

    document.getElementById("loginPassword").addEventListener("keypress", function (e) {
      if (e.key === "Enter") login();
    });

    // Кнопка выхода
    function logout() {
  auth.signOut().then(() => {
    adminPanel.style.display = "none";
    loginForm.style.display = "block";
  });
}
    
  // Переключение стилей заголовков 
const styleSelector = document.getElementById("heading-style");

styleSelector.addEventListener("change", function () {
  const selectedStyle = this.value;
  localStorage.setItem("headingStyle", selectedStyle);

  // Удаляем старые классы стилей
  document.body.classList.forEach(cls => {
    if (cls.startsWith("heading-")) {
      document.body.classList.remove(cls);
    }
  });

  // Применяем выбранный стиль сразу на админке
  if (selectedStyle) {
    document.body.classList.add("heading-" + selectedStyle);
  }
});

// При загрузке страницы применяем сохранённый стиль
window.addEventListener("DOMContentLoaded", () => {
  const savedStyle = localStorage.getItem("headingStyle");
  if (savedStyle) {
    document.body.classList.add("heading-" + savedStyle);
    styleSelector.value = savedStyle;
  }
});

// Редактирование портфолио


 async function addPortfolioCard() {
const accessKeyId = window.env.ACCESS_KEY;
const secretAccessKey = window.env.SECRET_KEY;
    const bucketName = 'portfolio-files';
    const region = 'ru-central1'; // регион Яндекс.Облака
    const folder = 'portfolio';

    const category = document.getElementById("portfolioCategory").value;
    const title = document.getElementById("portfolioTitle").value.trim();
    const description = document.getElementById("portfolioDescription").value.trim();
    const file = document.getElementById("portfolioFile").files[0];

    if (!title || !description || !file) {
      alert("Пожалуйста, заполните все поля и выберите PDF-файл.");
      return;
    }

    if (file.type !== "application/pdf") {
      alert("Пожалуйста, выберите файл в формате PDF.");
      return;
    }

    try {
      // 1. Получаем текущую дату
      const date = new Date().toISOString().slice(0, 10).replace(/-/g, '');
      const service = 's3';
      const host = `${bucketName}.storage.yandexcloud.net`;
      const algorithm = 'AWS4-HMAC-SHA256';
      const credentialScope = `${date}/${region}/${service}/aws4_request`;
      const filePath = `${folder}/${file.name}`;
      const url = `https://${host}/${filePath}`;

      // 2. Генерируем подпись
      const encoder = new TextEncoder();
      const hash = await crypto.subtle.digest('SHA-256', file);
      const payloadHash = Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2, '0')).join('');

      const amzDate = new Date().toISOString().replace(/[:-]|\.\d{3}/g, '');
      const canonicalRequest = [
        'PUT',
        `/${filePath}`,
        '',
        `host:${host}`,
        `x-amz-content-sha256:${payloadHash}`,
        `x-amz-date:${amzDate}`,
        '',
        'host;x-amz-content-sha256;x-amz-date',
        payloadHash
      ].join('\n');

      const stringToSign = [
        algorithm,
        amzDate,
        credentialScope,
        await sha256(canonicalRequest)
      ].join('\n');

      const signingKey = await getSignatureKey(secretAccessKey, date, region, service);
      const signature = await hmacSha256Hex(signingKey, stringToSign);

      const authorizationHeader = `${algorithm} Credential=${accessKeyId}/${credentialScope}, SignedHeaders=host;x-amz-content-sha256;x-amz-date, Signature=${signature}`;

      // 3. Загружаем файл через fetch
      const response = await fetch(url, {
        method: 'PUT',
        headers: {
          'Authorization': authorizationHeader,
          'x-amz-date': amzDate,
          'x-amz-content-sha256': payloadHash
        },
        body: file
      });

      if (!response.ok) throw new Error('Ошибка загрузки файла');

      // 4. Сохраняем карточку в Firestore
      await db.collection("portfolio").add({
        category,
        title,
        description,
        fileName: file.name,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });

      alert("Карточка добавлена!");
    } catch (error) {
      alert("Ошибка: " + error.message);
      console.error(error);
    }
  }

  async function sha256(str) {
    const encoder = new TextEncoder();
    const data = encoder.encode(str);
    const hash = await crypto.subtle.digest('SHA-256', data);
    return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2, '0')).join('');
  }

  async function hmacSha256Hex(key, msg) {
    const enc = new TextEncoder();
    const cryptoKey = await crypto.subtle.importKey('raw', key, { name: 'HMAC', hash: 'SHA-256' }, false, ['sign']);
    const signature = await crypto.subtle.sign('HMAC', cryptoKey, enc.encode(msg));
    return Array.from(new Uint8Array(signature)).map(b => b.toString(16).padStart(2, '0')).join('');
  }

  async function getSignatureKey(key, dateStamp, regionName, serviceName) {
    const kDate = await hmacSha256(`AWS4${key}`, dateStamp);
    const kRegion = await hmacSha256(kDate, regionName);
    const kService = await hmacSha256(kRegion, serviceName);
    return await hmacSha256(kService, 'aws4_request', true);
  }

  async function hmacSha256(key, msg, returnRaw = false) {
    const enc = new TextEncoder();
    const cryptoKey = await crypto.subtle.importKey('raw', typeof key === 'string' ? enc.encode(key) : key, { name: 'HMAC', hash: 'SHA-256' }, false, ['sign']);
    const signature = await crypto.subtle.sign('HMAC', cryptoKey, enc.encode(msg));
    return returnRaw ? signature : new Uint8Array(signature);
  }

    
  </script>

</body>
</html>
